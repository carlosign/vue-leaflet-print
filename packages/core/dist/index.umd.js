(function(o,f){typeof exports=="object"&&typeof module<"u"?f(exports,require("vue"),require("leaflet"),require("html-to-image"),require("leaflet-image")):typeof define=="function"&&define.amd?define(["exports","vue","leaflet","html-to-image","leaflet-image"],f):(o=typeof globalThis<"u"?globalThis:o||self,f(o.VueLeafletPrint={},o.Vue,o.L,o.htmlToImage$1,o.leafletImage$1))})(this,function(o,f,x,P,S){"use strict";function _(t){const l=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const e in t)if(e!=="default"){const u=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(l,e,u.get?u:{enumerable:!0,get:()=>t[e]})}}return l.default=t,Object.freeze(l)}const p=_(x),v={style:{display:"none"}},h=f.defineComponent({__name:"LPrintControl",props:{map:{},position:{default:"topright"},mode:{default:"image"},title:{default:"Imprimir / Exportar"},filename:{default:"map.png"},imageScale:{default:2},includeAttribution:{type:Boolean,default:!0},hideSelectors:{default:()=>[".leaflet-control-container",".no-print"]},label:{default:""},iconHtml:{default:"ðŸ–¨ï¸"},ariaLabel:{default:""}},emits:["start","success","error"],setup(t,{emit:l}){const e=t,u=l;let n=null;function a(){const i=p.Control.extend({options:{position:e.position},onAdd:()=>{const m=p.DomUtil.create("div","leaflet-control leaflet-control-print"),c=p.DomUtil.create("button","print-btn",m);c.type="button",c.title=e.title||"Imprimir / Exportar",c.setAttribute("role","button"),c.setAttribute("tabindex","0");const g=e.ariaLabel||e.label||e.title||"Imprimir / Exportar";return c.setAttribute("aria-label",g),e.label&&e.label.trim().length>0?c.textContent=e.label:c.innerHTML=e.iconHtml||"",p.DomEvent.disableClickPropagation(m),p.DomEvent.on(c,"click",d),c.addEventListener("keydown",b=>{(b.key==="Enter"||b.key===" ")&&(b.preventDefault(),b.stopPropagation(),d())}),m}});return new i}function r(){if(!e.map||n)return;const i=a();i.addTo(e.map),n=i}function s(){e.map&&(n&&(e.map.removeControl(n),n=null),r())}async function d(){try{if(u("start"),e.mode==="print")e.map.invalidateSize(),window.print();else if(e.mode==="image-leaflet"){const{exportPngLeafletImage:i}=await Promise.resolve().then(()=>T);await i(e.map,{filename:e.filename,pixelRatio:e.imageScale,includeAttribution:e.includeAttribution})}else{const{exportPngHtmlToImage:i}=await Promise.resolve().then(()=>C);await i(e.map,{filename:e.filename,pixelRatio:e.imageScale,hide:e.hideSelectors,includeAttribution:e.includeAttribution})}u("success")}catch(i){u("error",i),console.error(i)}}return f.onMounted(r),f.watch(()=>e.map,r),f.watch(()=>e.position,s),f.onBeforeUnmount(()=>{n&&e.map&&e.map.removeControl(n),n=null}),(i,m)=>(f.openBlock(),f.createElementBlock("div",v))}});function E(t){if(!t)throw new Error("Map instance is required");t.invalidateSize(),window.print()}async function y(t,l={}){if(!t)throw new Error("Map instance is required");t.invalidateSize();const e=t.getContainer(),u=[];(l.hide||[]).forEach(a=>{e.querySelectorAll(a).forEach(r=>{const s=r.style.visibility;r.style.visibility="hidden",u.push(()=>r.style.visibility=s)})});let n=null;if(l.includeAttribution){const a=e.querySelector(".leaflet-control-attribution");a&&(n=a.cloneNode(!0),Object.assign(n.style,{position:"absolute",right:"8px",bottom:"6px",background:"rgba(255,255,255,.85)",padding:"2px 6px",borderRadius:"3px"}),e.appendChild(n),u.push(()=>n&&n.remove()))}try{const a=await P.toPng(e,{cacheBust:!0,pixelRatio:(window.devicePixelRatio||1)*(l.pixelRatio||2),backgroundColor:"#ffffff"}),r=document.createElement("a");r.href=a,r.download=l.filename||"map.png",r.click()}finally{u.forEach(a=>a())}}const C=Object.freeze(Object.defineProperty({__proto__:null,exportPngHtmlToImage:y},Symbol.toStringTag,{value:"Module"}));async function w(t,l={}){if(!t)throw new Error("Map instance is required");t.invalidateSize();const e=document.createElement("a"),u=l.filename||"map.png";await new Promise((n,a)=>{S(t,(r,s)=>{if(r)return a(r);try{if(l.includeAttribution){const d=s.getContext("2d"),i="ï¿½ contributors";d.font="12px sans-serif",d.fillStyle="rgba(255,255,255,.85)";const m=6,c=d.measureText(i).width+m*2,g=20;d.fillRect(s.width-c-m,s.height-g-m,c,g),d.fillStyle="#000",d.fillText(i,s.width-c,s.height-9)}e.href=s.toDataURL("image/png"),e.download=u,e.click(),n()}catch(d){a(d)}})})}const T=Object.freeze(Object.defineProperty({__proto__:null,exportPngLeafletImage:w},Symbol.toStringTag,{value:"Module"}));function L(){return{install(t){t.component("LPrintControl",h)}}}o.LPrintControl=h,o.default=L,o.exportPngHtmlToImage=y,o.exportPngLeafletImage=w,o.printNative=E,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
